// ==UserScript==
// @name         showWholeTrainingPlan
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  Verbesserung der Trainingsplananzeige in Onlineliga
// @author       König von Weiden
// @match        https://www.onlineliga.de/
// @require      https://greasyfork.org/scripts/5392-waitforkeyelements/code/WaitForKeyElements.js?version=115012
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    /* Unser Skript soll nicht auf jeder Seite ausgeführt werden.
    Aus diesem Grund haben wir ein Element <div id="trainingWeektableContainer"> in der Trainingsplanansicht von Onlineliga gewählt, welches nur im Untermenüpunkt Training vorkommt.
    Mit Hilfe der Funktion waitForKeyElements, die mit dem Link unter require im Kopfbereich des Skriptes eingebunden wird, überprüfen wir, ob der entsprechende Div vorhanden ist.
    Falls ja, wird die Funktion showWholeTrainingPlan aufgerufen und unserer Skript startet.*/
    waitForKeyElements("div#trainingWeektableContainer",showWholeTrainingPlan);

    function showWholeTrainingPlan(){
        // Zuerst werden die Pfeile zum nach links und nach rechts scrollen entfernt, da wir diese später nicht mehr brauchen.
        $(".ol-scroll-overlay-left").remove();
        $(".ol-scroll-overlay-right").remove();

        // Im zweiten Schritt fixieren wir die Zeitleiste neben dem Trainingsplan, um eine Layout-Überlappung zu verhinden.
        $("div.ol-training-time-labels-left div:first-child").attr("style","position:relative;top:11px;");

        /* Beim Trainingsplan sind die Klassen-Namen der Divs für die Breite in der Darstellung des Trainingsplans verantwortlich.
        Aus diesem Grund löschen wir die alte Klasse und ersetzen sie durch eine niedrigere, was zu einer Verkleinerung der Trainingsblöcke führt.*/
        $("div.ol-training-weektable-matchblock.column-width-3.column-width-match").addClass("column-width-2").removeClass("column-width-3");
        $("div.ol-training-weektable-matchblock.column-width-3").addClass("column-width-2").removeClass("column-width-3");
        $("div.ol-training-day-column.column-width-3").addClass("column-width-2").removeClass("column-width-3");
        $("div.ol-training-day-column-head.column-width-3").addClass("column-width-2").removeClass("column-width-3");
        $("div.ol-training-weektable-block.column-width-3").addClass("column-width-2").removeClass("column-width-3");
        $("div.ol-training-day-column.column-width-3").addClass("column-width-2").removeClass("column-width-3");
        $("div.ol-training-day-column-head.column-width-4").addClass("column-width-3").removeClass("column-width-4");
        $("div.ol-training-weektable-block.column-width-4").addClass("column-width-3").removeClass("column-width-4");
        $("div.ol-training-day-column.column-width-4").addClass("column-width-3").removeClass("column-width-4");
        $("div.ol-training-day-column-head.column-width-6").addClass("column-width-4").removeClass("column-width-6");
        $("div.ol-training-weektable-head.column-width-43").addClass("column-width-29").removeClass("column-width-43");

        /* Trotz Verkleinerung der Trainingsblöcke kann es vorkommen, dass die von Onlineliga zur Verfügung gestellte Breite für die Trainingsplanansicht nicht ausreicht.
        Deshalb fragen wir hier die notwenige Breite ab und erweitern das verantwortliche Div entsprechend.*/
        var lengthWeektable = $(".ol-training-weektable-head").width()+55;
        $("div#trainingWeektableContainer.ol-training-overview-table-container.ol-scroll-overlay-content").attr("style","overflow-x:hidden;width:"+lengthWeektable+"px;");

        /* Im Vordergrund existiert noch ein Raster, das die alten Breiten aufweist und minimal störend wirkt.
        Dieses passen wir für unseren Trainingsplan deshlab noch einmal an.*/
        $("div.ol-training-day-column-sep.column-left-3").addClass("column-left-2").removeClass("column-left-3");
        $("div.ol-training-day-column-sep.column-left-6").addClass("column-left-4").removeClass("column-left-6");
        $("div.ol-training-day-column-sep.column-left-12").addClass("column-left-8").removeClass("column-left-12");
        $("div.ol-training-day-column-sep.column-left-18").addClass("column-left-12").removeClass("column-left-18");
        $("div.ol-training-day-column-sep.column-left-24").addClass("column-left-16").removeClass("column-left-24");
        $("div.ol-training-day-column-sep.column-left-30").addClass("column-left-20").removeClass("column-left-30");
        $("div.ol-training-day-column-sep.column-left-36").addClass("column-left-24").removeClass("column-left-36");
        $("div.ol-training-day-column-sep.column-left-40").addClass("column-left-27").removeClass("column-left-40");
        $("div.ol-training-day-column-sep.column-left-43").addClass("column-left-29").removeClass("column-left-43");

        // Da die Warnungs- und Verletzungssymbole nicht mehr ganz zum neuen Layout passen, müssen wir hier noch kurz die Abstände anpassen.
        $("div.ol-training-timetable-block-injury").attr("style","margin-right:5px;");
        $("div.ol-training-timetable-block-warning").attr("style","margin-right:5px;");
    }
})();
